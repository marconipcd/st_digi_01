var requestAtivo;function atualizaTotal(){var b,d,a,c;valor_frete=parseFloat($("input[name=formaEnvio]:checked").attr("data-valor")||0);cupom=$("#cupom_desconto").attr("data-cupom-desconto-codigo");aplicar_no_total=$("[data-desconto-valor]").attr("data-desconto-aplicar-no-total")||"não";a=parseFloat($("[data-subtotal-valor]").attr("data-subtotal-valor")||0);envio_id=$("input[name=formaEnvio]:checked").val()||null;envio_code=$("input[name=formaEnvio]:checked").data("code");if(requestAtivo){requestAtivo.abort();requestAtivo=null}$(".valor-total").addClass("valor-loading");requestAtivo=$.getJSON("/carrinho/valor/",{envio_id:envio_id,envio_code:envio_code,valor_frete:valor_frete,valor_subtotal:a,cupom:cupom},function(e){$(".valor-total").html("R$ "+formatar_decimal_br(e.total));$(".valor-total").attr("data-total-valor",e.total);if($("#li-box-payment-minimum-value").length>0){if(e.pci_total>=e.minimum_value.value){$("#li-box-payment-minimum-value").slideUp()}else{if(e.minimum_value.value>0){$(".li-box-payment-minimum-value-left").text("R$"+formatar_decimal_br(e.minimum_value.value-e.pci_total));$("#li-box-payment-minimum-value").slideDown()}}}if($(".valores-descontos").length){$(".valores-descontos").load("/carrinho/valor-descontos",function(){$(".valor-total").removeClass("valor-loading")})}else{$(".valor-total").removeClass("valor-loading")}}).fail(function(){$(".valor-total").removeClass("valor-loading")})}var frete_gratis=false;function carregarFormasEnvio(c,a){var b=URL_CALCULO_FRETE;$(".formas-envio").addClass("valor-loading");$.getJSON(b,c,function(g){if(g.deliveries&&g.deliveries.length>0){$(".formas-envio ul").html("");var f="";f="<li>";f+='<label class="radio">';f+='<input type="radio" name="formaEnvio" value=":id:" data-valor=":valor_float:" data-code=":code:">';f+='<b class="prazo">:prazo: :prazo_dia:</b> ';f+='<span class="cor-principal valor">R$ :valor:</span> ';f+='<span class="nome">:nome:</span>';for(var h in g.deliveries){var i=g.deliveries[h];var d=f;if(i.name){if(i.type=="mercadoenvios_api"){i.name=i.name.replace("MercadoEnvios ","")}d=d.replace(":id:",i.id);d=d.replace(":nome:",i.name);if(frete_gratis&&i.service_name=="frete_gratis"){d=d.replace(":valor:","0,00");d=d.replace(":valor_float:","0")}else{d=d.replace(":valor:",formatar_decimal_br(i.price));d=d.replace(":valor_float:",i.price)}d=d.replace(":code:",i.code);d=d.replace(":prazo:",i.deliveryTime);d=d.replace(":prazo_dia:",i.deliveryTime==1?"dia útil":"dias úteis");if(i.msgErro){d+='<span class="aviso" style="display: none;">'+i.msgErro+"</span>"}d+="</li>";$(".formas-envio ul").append(d)}}if($.cookie("forma_envio")){$(".formas-envio input[value="+$.cookie("forma_envio")+"]").prop("checked",true);if($.cookie("forma_envio_code")){$(".formas-envio input[value="+$.cookie("forma_envio")+"][data-code="+$.cookie("forma_envio_code")+"]").prop("checked",true);console.log("tem cookie "+$(".formas-envio input[value="+$.cookie("forma_envio")+"][data-code="+$.cookie("forma_envio_code")+"]").selector)}}atualizaTotal()}else{$(".formas-envio ul").html("");if(!a){setTimeout(function(){carregarFormasEnvio(c,true)},500)}else{$(".formas-envio ul").append("<li>Nenhuma forma de envio encontrada.</li>")}}}).fail(function(){$(".formas-envio ul").html("");if(!a){setTimeout(function(){carregarFormasEnvio(c,true)},500)}else{$(".formas-envio ul").append("<li>Não foi possível carregar as formas de envio. Tente novamente.</li>")}}).always(function(){$(".formas-envio").removeClass("valor-loading")})}$(document).ready(function(){$("[rel=tooltip]").tooltip();if($("[data-desconto-tipo]").attr("data-desconto-tipo")=="frete-gratis"){frete_gratis=true}if($.cookie("cep")&&$.cookie("cep")!==$("#formCalcularFrete .input-cep").val()){$("#formCalcularFrete .input-cep").val($.cookie("cep"))}$("#formCalcularFrete").submit(function(){var a=$(this).find(".input-cep").val();if(!a){return false}var b={cep:a};$.cookie("cep",a,{expires:7,path:"/"});carregarFormasEnvio(b,false);return false}).submit();$("#formCalcularFrete .input-cep").bind("change keyup input",function(){var b=$(this).data("cep_old");var a=$(this).val();if(b!=a){if($(this).val().length==9&&$(this).val().indexOf("_")<0){$(this).data("cep_old",a);$("#formCalcularFrete").submit()}}});$(".formas-envio ul").click(function(){var b=$('input[name="formaEnvio"]:checked').val();$.cookie("forma_envio",b,{expires:7,path:"/"});var a=$('input[name="formaEnvio"]:checked').attr("data-code");$.cookie("forma_envio_code",a,{expires:7,path:"/"});atualizaTotal()});$(".formas-envio").on("change",'input[name="formaEnvio"]',function(){if($("#formCalcularFrete .controls .envio-aviso").length){$("#formCalcularFrete .controls .envio-aviso").remove()}if($(this).parent().find(".aviso").length){$("#formCalcularFrete .controls").append('<p class="envio-aviso">'+$(this).parent().find(".aviso").text()+"</p>")}});if($(".tabela-carrinho").length){atualizaTotal()}$("#modalSolicitarOrcamento").on("hidden",function(a){$(this).removeData()});$("[name=quantidade]").keyup(function(a){$(this).parent().find(".atualizar-quantidade").fadeIn()});$("[name=quantidade]").focusout(function(a){$(this).parent().find(".atualizar-quantidade").fadeOut()})});